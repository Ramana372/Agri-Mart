<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AgriMart | List Product</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-success">
    <div class="container-fluid">
        <a class="navbar-brand" href="home.html">AgriMart ðŸŒ¿</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="nav">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item"><a class="nav-link" href="home.html">Home</a></li>
                <li class="nav-item"><a class="nav-link" href="products.html">Products</a></li>
                <li class="nav-item"><a class="nav-link active" href="Addproducts.html">List Product</a></li>
                <li class="nav-item"><a class="nav-link" href="about.html">About</a></li>
                <li class="nav-item"><a class="nav-link" href="login.html" id="authToggle">Login</a></li>
            </ul>
        </div>
    </div>
</nav>

<div class="container my-5">
    <h2 class="mb-4 text-center">List Your Equipment for Rent or Sale</h2>

    <form id="productForm" class="mx-auto" style="max-width: 600px;">
        <div class="mb-3">
            <label for="type" class="form-label">Listing Type</label>
            <select class="form-select" id="type" required>
                <option value="">-- Select --</option>
                <option value="RENT">Rent</option>
                <option value="SELL">Sell</option>
            </select>
        </div>
        <div class="mb-3">
            <label for="productname" class="form-label">Product Name</label>
            <input type="text" class="form-control" id="productname" placeholder="e.g. Manual Seed Drill" required>
        </div>
        <div class="mb-3">
            <label for="desc" class="form-label">Description / Condition</label>
            <input type="text" class="form-control" id="desc" placeholder="e.g. Good, Like New" required>
        </div>
        <div class="mb-3">
            <label for="location" class="form-label">Location</label>
            <input type="text" class="form-control" id="location" placeholder="e.g. Kurnool" required>
        </div>
        <div class="mb-3">
            <label for="price" class="form-label">Price (â‚¹)</label>
            <input type="number" class="form-control" id="price" placeholder="e.g. 4500 or 500/day" required>
        </div>
        <div class="mb-3">
            <label for="owner" class="form-label">Your Name</label>
            <input type="text" class="form-control" id="owner" placeholder="e.g. Ramu Farmer" required>
        </div>

        <button type="submit" class="btn btn-success w-100">Submit Product</button>
    </form>

    <div id="message" class="mt-3 text-center"></div>
</div>

<script>
    document.getElementById("productForm").addEventListener("submit", function (e) {
        e.preventDefault();

        const data = {
            productname: document.getElementById("productname").value,
            description: document.getElementById("desc").value,
            location: document.getElementById("location").value,
            price: parseFloat(document.getElementById("price").value),
            ownerName: document.getElementById("owner").value,
            category: document.getElementById("type").value
        };

        if (!data.category) {
            document.getElementById("message").innerHTML = `<div class="alert alert-warning">Please select listing type.</div>`;
            return;
        }

        fetch("http://localhost:8090/product/add", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(data)
        })
            .then(res => {
                if (!res.ok) throw new Error("Server returned an error");
                return res.json();
            })
            .then(product => {
                document.getElementById("message").innerHTML = `
                <div class="alert alert-success">
                    "${product.productname}" listed successfully under <b>${product.category}</b>!
                </div>
            `;
                document.getElementById("productForm").reset();
            })
            .catch(err => {
                document.getElementById("message").innerHTML = `
                <div class="alert alert-danger">Failed to submit product. Try again.</div>
            `;
                console.error("Error submitting product:", err);
            });
    });

    const loggedIn = false;
    document.getElementById("authToggle").textContent = loggedIn ? "Logout" : "Login";
    document.getElementById("authToggle").href = loggedIn ? "logout.html" : "login.html";
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
