<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AgriMart | Payment</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
    }
    .summary-card {
      max-width: 500px;
      margin: 50px auto;
      padding: 30px;
      border: 1px solid #ddd;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .form-group {
      margin-bottom: 1rem;
    }
  </style>
</head>
<body>

<div class="container">
  <div class="summary-card">
    <h3 class="mb-4">Payment Summary</h3>
    <div id="productSummary">
      <p><strong>Product:</strong> <span id="productName"></span></p>
      <p><strong>Description:</strong> <span id="description"></span></p>
      <p><strong>Owner:</strong> <span id="ownerName"></span></p>
      <p><strong>Type:</strong> <span id="category"></span></p>
      <p><strong>Price:</strong> ₹<span id="price"></span></p>
    </div>

    <div id="rentalDaysInput" class="form-group" style="display:none;">
      <label for="days">Enter number of days to rent:</label>
      <input type="number" id="days" class="form-control" min="1" value="1">
    </div>

    <div class="form-group mt-3">
      <label><strong>Payment Method</strong></label>
      <select class="form-select" id="paymentMethod">
        <option value="upi">UPI</option>
        <option value="card">Credit/Debit Card</option>
      </select>
    </div>

    <p class="mt-3"><strong>Total:</strong> ₹<span id="totalAmount"></span></p>
    <button class="btn btn-success w-100 mt-3" onclick="submit()">Pay Now</button>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const product = JSON.parse(localStorage.getItem("selectedProduct"));

    if (!product) {
      document.getElementById("productSummary").innerHTML =
              "<p class='text-danger'>No product selected.</p>";
      return;
    }

    document.getElementById("productName").textContent = product.productname;
    document.getElementById("description").textContent = product.description;
    document.getElementById("ownerName").textContent = product.ownerName;
    document.getElementById("category").textContent = product.category.toUpperCase();
    document.getElementById("price").textContent = product.price;

    const isRent = product.category.toLowerCase() === "rent";

    if (isRent) {
      document.getElementById("rentalDaysInput").style.display = "block";

      const daysInput = document.getElementById("days");
      const price = Number(product.price);
      const updateTotal = () => {
        const days = Number(daysInput.value || 1);
        const total = days * price;
        document.getElementById("totalAmount").textContent = total;
      };

      updateTotal();

      daysInput.addEventListener("input", updateTotal);
    } else {
      document.getElementById("totalAmount").textContent = product.price;
    }
  });

  function submit() {
    const product = JSON.parse(localStorage.getItem("selectedProduct"));

    if (!product) {
      alert("No product selected.");
      return;
    }

    const isRent = product.category.toLowerCase() === "rent";
    const days = isRent ? Number(document.getElementById("days").value || 1) : 1;
    const totalAmount = Number(product.price) * days;
    const paymentMethod = document.getElementById("paymentMethod").value;

    const paymentData = {
      productName: product.productname,
      description: product.description,
      ownerName: product.ownerName,
      category: product.category,
      price: product.price,
      days: days,
      totalAmount: totalAmount,
      paymentMethod: paymentMethod
    };

    fetch("http://localhost:8090/payment/add", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(paymentData)
    })
            .then(response => {
              if (response.ok) {
                alert("Payment Successful");
                window.location.href = "home.html";
              } else {
                alert("Payment failed. Try again.");
              }
            })
            .catch(err => {
              console.error("Error:", err);
              alert("An error occurred.");
            });
  }
</script>

</body>
</html>
